function refreshFeed(e,t){e&&$feed.html(loading),jQuery.ajax("server.php",{data:{action:"get-feed",since:feedSince},type:"GET",error:function(){}}).done(function(e){e=handleAjaxResponse(e),e.events.sort(function(e,t){return e.time<t.time?-1:e.time>t.time?1:0});for(var s="",n=e.events.length-1;n>=0;n--){var a=e.events[n],i=e.events[n].info;switch(s+="<tr><td>",a.type){case 0:s+='<img src="img/users.svg"></td><td>'+i.firstname+" "+i.lastname+" has added you.";break;case 1:s+='<img src="img/share.svg"></td><td>'+i.user.firstname+" "+i.user.lastname+" gave you permissions to "+(1==i.permissions?"edit":"view")+' their list <a href="#/word-lists/'+i.list.id+'">'+i.list.name+"</a>.";break;case 2:s+='<img src="img/add.svg"></td><td>'+i.user.firstname+" "+i.user.lastname+" has added "+i.amount.toEnglishString()+" word"+(1!==i.amount?"s":"")+" to "+(i.user.id===i.list.creator?"their":i.list.creator===e.user?"your":i.list_creator.firstname+"'s")+' list <a href="#/word-lists/'+i.list.id+'">'+i.list.name+"</a>."}s+='&nbsp;<span class="feed-time">'+new Date(1e3*a.time).toDefaultString()+"</span></td></tr>"}s=0===s.length?noFeedContent:'<table class="feed-table box-table">'+s+"</table>",$feed.html(s),void 0!==t&&t(e)})}function refreshRecentlyUsed(e){e&&$recentlyUsed.html(loading),jQuery.ajax("server.php",{data:{action:"get-last-used-n-lists",limit:15},type:"GET",error:function(){}}).done(function(e){if(e=handleAjaxResponse(e),0===e.length)$recentlyUsed.html(noRecentlyUsed);else{for(var t='<table class="box-table cursor-pointer">',s=0;s<e.length;s++)t+='<tr data-list-id="'+e[s].id+'"><td>'+e[s].name+"</td></tr>";t+="</table>",$recentlyUsed.html(t),$recentlyUsed.find("tr").on("click",function(){window.location.href="#/word-lists/"+$(this).data("list-id")})}})}var $feed=$("#feed"),noFeedContent="<p>Nothing new since last login.</p>",feedSince=-1;$("#feed-load-all").on("click",function(){$("#feed-load-all").prop("disabled",!0).attr("value","Loading all..."),feedSince=0,refreshFeed(!1,function(){$("#feed-load-all").hide()})});var $recentlyUsed=$("#recently-used"),noRecentlyUsed="<p>No recently used lists found.</p>";refreshFeed(!0),refreshRecentlyUsed(!0);
function addWordList(t,e){jQuery.ajax("server.php",{data:{action:"add-word-list",name:t},type:"GET",error:function(){}}).done(function(t){t=handleAjaxResponse(t),e(t)})}function refreshListOfWordLists(t,e,a){void 0===a&&(a=!1),t&&$("#list-of-word-lists").html(loading),showNoListSelectedInfo(!a),ajaxRequests.loadListOfWordLists.add(jQuery.ajax("server.php",{data:{action:"list-of-word-lists"},type:"GET",error:function(){}}).done(function(t){t=handleAjaxResponse(t);for(var e="",a=0;a<t.length;a++)e+="<tr "+(t[a].id==shownListId?'class="active" ':"")+'data-action="edit" data-list-id="'+t[a].id+'" id="list-of-word-lists-row-'+t[a].id+'"><td>'+t[a].name+"</td></tr>";e=0===e.length?noWordListOutput:'<table class="box-table cursor-pointer"></tr>'+e+"</table>",$("#list-of-word-lists").html(e),$("#list-of-word-lists tr").on("click",function(){window.location.hash="#/word-lists/"+$(this).data("list-id")})}))}function setAllListRowsAsNotActive(){$("#list-of-shared-word-lists tr, #list-of-word-lists tr").removeClass("active")}function refreshListOfSharedWordLists(t,e){void 0===e&&(e=!1),t&&$("#list-of-shared-word-lists").html(loading),showNoListSelectedInfo(!e),ajaxRequests.loadListOfSharedWordLists.add(jQuery.ajax("server.php",{data:{action:"list-of-shared-word-lists-with-user"},type:"GET",error:function(){}}).done(function(t){t=handleAjaxResponse(t);for(var e="",a=0;a<t.length;a++)e+="<tr "+(t[a].id==shownListId?'class="active" ':"")+'data-action="'+(1==t[a].permissions?"edit":"view")+'" data-list-id="'+t[a].id+'" data-sharing-id="'+t[a].sharing_id+'" id="list-of-shared-word-lists-row-'+t[a].sharing_id+'">',e+="<td>"+t[a].name+"</td>";e=0===e.length?noSharedWordListOutput:'<table class="box-table cursor-pointer">'+e+"</table>",$("#list-of-shared-word-lists").html(e),$("#list-of-shared-word-lists tr").on("click",function(){window.location.hash="#/word-lists/"+$(this).data("list-id")})}))}function showNoListSelectedInfo(t){shownListId=-1,shownListData=null,t===!0&&(window.location.hash="#/word-lists"),$("#word-list-info .box-head > div").html("Word lists"),$("#word-list-info .box-body").html('<p class="spacer-30">Create or select a word list to get started.</p>'),$("#word-list-info-words").hide(),$("#word-list-title").hide(),$("#word-list-sharing").hide(),$("#word-list-label").hide()}function loadWordList(t,e,a){e&&($("#word-list-info .box-head > div").html("Loading..."),$("#word-list-info .box-body").html(loading),$("#word-list-info-words").hide(),$("#word-list-sharing").hide(),$("#word-list-label").hide(),$("#word-list-title").hide()),a===!0&&"#word-lists"!==window.location.hash&&(window.location.hash="#word-lists"),setAllListRowsAsNotActive(),$("#list-of-word-lists tr[data-list-id="+t+"], #list-of-shared-word-lists tr[data-list-id="+t+"]").addClass("active").find("input[type=button]").first().hide(),shownListId=t,ajaxRequests.loadWordList.add(jQuery.ajax("server.php",{data:{action:"get-word-list",word_list_id:t},type:"GET",error:function(){}}).done(function(t){if(t=handleAjaxResponse(t),refreshRecentlyUsed(!1),shownListData=t.list,null===shownListData)return void(window.location.hash="#/word-lists");var e=t.allowEdit,a=t.allowSharing;shownListData.language1||(shownListData.language1="First language"),shownListData.language2||(shownListData.language2="Second language"),$("#word-list-title .box-head").html(shownListData.name),$("#word-list-info .box-head > div").html("General");var s="";if(a?(s+="<p>You own this list.</p>",s+='<p><form id="rename-list-form"><input type="text" id="rename-list-name" required="true" placeholder="List name" value="'+shownListData.name+'" class="inline"/>&nbsp;<input type="submit" value="Rename" id="rename-list-button" class="inline"/></form></p>',s+='<input type="button" class="inline" value="Delete list" id="delete-shown-word-list"/>'):(s+="<p>"+shownListData.creator.firstname+" "+shownListData.creator.lastname+" shares this list with you.</p>",s+="<p>You have permissions to "+(e?"edit":"view")+" "+shownListData.creator.firstname+"'s list.</p>",s+='<input type="button" class="inline" value="Hide list" id="hide-shown-word-list"/>'),e&&(s+='<div class="inline"><p><form id="change-language-form"><input id="word-list-language1" required="true" type="text" placeholder="First language" value="'+shownListData.language1+'""/>&nbsp;<input id="word-list-language2" required="true" type="text" placeholder="Second language" value="'+shownListData.language2+'" />&nbsp;<input type="submit" id="word-list-languages-button" value="Edit languages"/></form></p></div>'),$("#word-list-info .box-body").html(s),$("#words-add-language1").attr("placeholder",shownListData.language1),$("#words-add-language2").attr("placeholder",shownListData.language2),a?(refreshListSharings(!0,shownListData.id),$("#word-list-sharing").show()):$("#word-list-sharing").hide(),$("#shown-word-list-words-count").html(shownListData.words.length),0===shownListData.words.length)$("#words-in-list").html(e?noWordsInList:noWordsInListDisallowEdit);else{for(var i="",l=0;l<shownListData.words.length;l++)i+=getTableRowOfWord(shownListData.words[l].id,shownListData.words[l].language1,shownListData.words[l].language2,e);i=getTableOfWordList(i,e,shownListData.language1,shownListData.language2),$("#words-in-list").html(i)}$("#delete-shown-word-list").on("click",function(){var t=new MessageBox;t.setTitle("Delete word list"),t.setContent('Do you want to delete the word list <span class="italic">'+shownListData.name+"</span>?"),t.setButtons(MessageBox.ButtonType.YesNoCancel),t.setCallback(function(t){"Yes"===t&&($(this).prop("disabled",!0).attr("value","Deleting..."),deleteWordList(shownListId,function(){showNoListSelectedInfo(!0)}))}),t.show()}),$("#hide-shown-word-list").on("click",function(){var t=new MessageBox;t.setTitle("Hide word list"),t.setContent('Do you want to hide the word list <span class="italic">'+shownListData.name+"</span>?"),t.setButtons(MessageBox.ButtonType.YesNoCancel),t.setCallback(function(t){if("Yes"===t){$(this).prop("disabled",!0).attr("value","Hiding list...");var e=$("tr[data-list-id="+shownListId+"]").data("sharing-id");setSharingPermissionsBySharingId(e,0,function(){$("#list-of-shared-word-lists-row-"+e).remove(),1==$("#list-of-shared-word-lists tr").length&&$("#list-of-shared-word-lists").html(noSharedWordListOutput),showNoListSelectedInfo(!0)})}}),t.show()}),$("#rename-list-form").on("submit",function(t){t.preventDefault();var e=$("#rename-list-name"),a=$("#rename-list-button");e.prop("disabled",!0),a.prop("disabled",!0).attr("value","Renaming...");var s=e.val();renameList(shownListId,s,function(t){e.prop("disabled",!1),a.prop("disabled",!1).attr("value","Rename"),t.name=s,$("#word-list-title .box-head").html(s),$("#list-of-word-lists-row-"+shownListId).children().first().html(s)})}),$("#change-language-form").on("submit",function(t){t.preventDefault();var e=$("#word-list-language1"),a=$("#word-list-language2"),s=$("#word-list-languages-button");e.prop("disabled",!0),a.prop("disabled",!0),s.prop("disabled",!0).attr("value","Editing languages...");var i=e.val(),l=a.val();setWordListLanguages(shownListId,i,l,function(t){e.prop("disabled",!1),a.prop("disabled",!1),s.prop("disabled",!1).attr("value","Edit languages"),t.language1=i,t.language2=l,$("#words-add-language1").attr("placeholder",i),$("#words-add-language2").attr("placeholder",l),$("#word-list-table").find("td").eq(0).html(i),$("#word-list-table").find("td").eq(1).html(l)})}),$("#word-list-title").show(),$("#word-list-info-words").show(),e?$("#words-add").show():$("#words-add").hide(),getLabelList(!0),$("#word-list-label").show()}))}function getTableRowOfWord(t,e,a,s){return'<tr id="word-row-'+t+'"><td>'+e+"</td><td>"+a+"</td>"+(s?'<td><input type="submit" class="inline" value="Edit" data-action="edit" form="word-row-'+t+'-form"/>&nbsp;<input type="button" class="inline" value="Remove" onclick="removeWord('+t+')"/><form id="word-row-'+t+'-form" onsubmit="editSaveWord(event, '+t+')"></form></td>':"")+"</tr>"}function getTableOfWordList(t,e,a,s){return'<table id="word-list-table" class="box-table '+(e?"button-right-column":"")+'"><tr class="bold cursor-default"><td>'+a+"</td><td>"+s+"</td>"+(e?"<td></td>":"")+"</tr>"+t+"</table>"}function exportList(t){void 0===t&&(t=shownListData);for(var e="",a=0;a<t.words.length;a++)e+=t.words[a].language1+" | "+t.words[a].language2+"\n"}function editSaveWord(t,e){t.preventDefault();var a=$("#word-row-"+e),s=a.find("input[type=submit]"),i=a.children().eq(0),l=a.children().eq(1);if("edit"==s.data("action"))s.data("action","save").attr("value","Save"),i.html('<input type="text" class="inline-both" form="word-row-'+e+'-form" id="word-edit-input-language1-'+e+'" value="'+i.html()+'" />'),l.html('<input type="text" class="inline-both" form="word-row-'+e+'-form" id="word-edit-input-language2-'+e+'" value="'+l.html()+'" />');else{var n=$("#word-edit-input-language1-"+e),o=$("#word-edit-input-language2-"+e);n.prop("disabled",!0),o.prop("disabled",!0),s.prop("disabled",!0).attr("value","Saving..."),saveWord(e,n.val(),o.val(),function(){s.prop("disabled",!1).attr("value","Edit").data("action","edit"),i.html(n.val()),l.html(o.val())})}}function saveWord(t,e,a,s){jQuery.ajax("server.php",{data:{action:"update-word",word_id:t,lang1:e,lang2:a},type:"GET",error:function(){}}).done(function(t){t=handleAjaxResponse(t),s(t)})}function setWordListLanguages(t,e,a,s){jQuery.ajax("server.php",{data:{action:"set-word-list-languages",word_list_id:t,lang1:e,lang2:a},type:"GET",error:function(){}}).done(function(t){t=handleAjaxResponse(t),s(t)})}function removeWord(t){var e=shownListId,a=$("#word-row-"+t),s=a.find("* input[type=button]");s.prop("disabled",!0).attr("value","Removing..."),jQuery.ajax("server.php",{data:{action:"remove-word",word_id:t},type:"GET",error:function(){}}).done(function(s){if(s=handleAjaxResponse(s),shownListId===e){for(var i=0;i<shownListData.words.length;i++)if(shownListData.words[i].id===t){shownListData.words.splice(i,1);break}$("#shown-word-list-words-count").html(shownListData.words.length),a.remove(),1==$("#word-list-table tr").length&&$("#word-list-table").html(noWordInList)}})}function deleteWordList(t,e){jQuery.ajax("server.php",{data:{action:"delete-word-list",word_list_id:t},type:"GET",error:function(){}}).done(function(a){a=handleAjaxResponse(a),$("#list-of-word-lists-row-"+t).remove(),1==$("#list-of-word-lists tr").length&&$("#list-of-word-lists").html(noWordListOutput),e()})}function addWord(t,e,a){var s=shownListId;jQuery.ajax("server.php",{data:{action:"add-word",word_list_id:s,lang1:t,lang2:e},type:"GET",error:function(){}}).done(function(i){if(i=handleAjaxResponse(i),shownListId===s){if(shownListData.words.push({id:i,list:shownListId,language1:t,language2:e,answers:null}),$("#shown-word-list-words-count").html(shownListData.words.length),0===$("#word-list-table").length){var l=getTableOfWordList("",a,shownListData.language1,shownListData.language2);$("#words-in-list").html(l)}$("#word-list-table tr:nth-child(1)").after(getTableRowOfWord(i,t,e,a))}})}function refreshListSharings(t,e){void 0===e&&(e=shownListId),$("#word-list-sharing").show(),t&&$("#list-sharings").html(loading),ajaxRequests.refreshListSharings.add(jQuery.ajax("server.php",{data:{action:"get-sharing-info-of-list",word_list_id:e},type:"GET",error:function(){}}).done(function(t){if(t=handleAjaxResponse(t),0===t.length)$("#list-sharings").html(listNotShared);else{for(var e="",a=0;a<t.length;a++)e+='<tr id="list-shared-with-row-'+t[a].id+'">',e+="<td>"+t[a].user.firstname+" "+t[a].user.lastname+"</td>",e+="<td>"+(1==t[a].permissions?"Can edit":"Can view")+"</td>",e+='<td><input type="button" class="inline" value="Stop sharing" data-action="delete-sharing" data-sharing-id="'+t[a].id+'"/></td></tr>';e='<table class="box-table button-right-column"><tr class="bold cursor-default"><td>Name</td><td>Permissions</td><td></td></tr>'+e+"</table>",$("#list-sharings").html(e),$("#list-sharings input[type=button]").on("click",function(){var t=$(this);t.prop("disabled",!0).attr("value","Stopping sharing..."),setSharingPermissionsBySharingId(t.data("sharing-id"),0,function(){$("#list-shared-with-row-"+t.data("sharing-id")).remove(),1==$("#list-sharings tr").length&&$("#list-sharings").html(listNotShared)})})}}))}function setSharingPermissionsBySharingId(t,e,a){jQuery.ajax("server.php",{data:{action:"set-sharing-permissions-by-sharing-id",sharing_id:t,permissions:e},type:"GET",error:function(){}}).done(function(t){t=handleAjaxResponse(t),a(t)})}function setSharingPermissions(t,e,a,s){jQuery.ajax("server.php",{data:{action:"set-sharing-permissions",word_list_id:t,email:e,permissions:a},type:"GET",error:function(){}}).done(function(t){t=handleAjaxResponse(t),s(t)})}function getLabelList(t){t&&$("#list-labels-list").html(loading),jQuery.ajax("server.php",{data:{action:"get-labels-of-user"},type:"GET",error:function(){}}).done(function(t){labels=handleAjaxResponse(t),$("#list-labels-list").html(getEditableHtmlTableOfLabels(labels)),$("#list-labels-list img.small-menu-open-image").on("click",function(t){$(".small-menu").addClass("display-none"),$(this).next().removeClass("display-none"),t.stopPropagation()}),$("#list-labels-list .small-menu input").on("click",function(){$(this).parents(".small-menu").addClass("display-none")}),$("#list-labels-list .small-menu").on("click",function(t){t.stopPropagation()}),$("#list-labels-list input[type=checkbox]").click(function(){var t=$(this).data("label-id");$(this).is(":checked")?attachListToLabel(t,shownListId,function(){shownListData.labels.push(labels[getLabelIndexByLabelId(labels,t)])}):detachListFromLabel(t,shownListId,function(){shownListData.labels.splice(getLabelIndexByLabelId(shownListData.labels,t),1)})}),$(".label-add-form").on("submit",function(t){t.preventDefault();var e=$(this).children(".label-add-button").prop("disabled",!0).attr("value","Adding label..."),a=$(this).children(".label-add-name").prop("disabled",!0),s=$(this).children(".label-add-parent").prop("disabled",!0);expandedLabelsIds.push(parseInt(s.val())),addLabel(shownListId,a.val(),s.val(),function(){getLabelList(!1),e.prop("disabled",!1).attr("value","Add label"),a.prop("disabled",!1).val(""),s.prop("disabled",!1).val(null)})}),$(".label-remove-form").on("submit",function(t){t.preventDefault(),$(this).children(".label-remove-select").prop("disabled",!0),$(this).children(".label-remove-button").prop("disabled",!0).attr("value","Removing...");var e=$(this).children(".label-remove-select").val();removeLabel(e,function(){$(this).children(".label-remove-select").prop("disabled",!1),$(this).children(".label-remove-button").prop("disabled",!1).attr("value","Remove label"),shownListData.labels.splice(getLabelIndexByLabelId(shownListData.labels,e),1),getLabelList(!1)})}),$(".label-add-sub-label").on("click",function(){$(this).hide().parent().parent().parent().next().show().children().find("input[type=text]").first().focus()}),$(".label-rename-form").on("submit",function(t){t.preventDefault();var e=$(this).data("label-id"),a=$("#label-rename-button-"+e),s=$("#label-rename-table-cell-"+e);if("rename-edit"==a.data("action")){var i=labels[getLabelIndexByLabelId(labels,e)].name;s.find("label span").html(""),s.append('&nbsp;<input type="text" form="label-rename-form-'+e+'" class="inline" value="'+i+'" required="true"/>'),a.data("action","rename-save")}else{var l=s.children("input").first(),n=l.val();a.prop("disabled",!0).attr("value","Renaming..."),l.prop("disabled",!0),renameLabel(e,n,function(){a.prop("disabled",!1).attr("value","Rename").data("action","rename-edit"),s.children("input").remove(),s.find("label span").html("&nbsp;"+n),labels[getLabelIndexByLabelId(labels,e)].name=n})}}),$("#list-labels-list .small-exp-col-icon").on("click",function(){for(var t=$(this),e="collapsed"==t.data("state"),a=0,s=t.parent().parent(),i=s.nextAll(),l=s.data("indenting");i.eq(a).length>0&&(i.eq(a).data("indenting")>l||void 0===i.eq(a).data("indenting"));)i.eq(a).data("indenting")!=l+1&&e||(e?i.eq(a).show():(i.eq(a).hide(),i.eq(a).find(".small-exp-col-icon").attr("src","img/expand.svg").data("state","collapsed"),expandedLabelsIds.removeAll(parseInt(i.eq(a).data("label-id"))))),a++;e?(t.data("state","expanded").attr("src","img/collapse.svg"),expandedLabelsIds.push(parseInt(s.data("label-id")))):(t.data("state","collapsed").attr("src","img/expand.svg"),expandedLabelsIds.removeAll(parseInt(s.data("label-id"))))})})}function getEditableHtmlTableOfLabels(t){var e=getHtmlListOfLabelId(t,0,0);return e=e.length>0?'<table class="box-table button-right-column">'+e+"</table>":noLabels}function getHtmlListOfLabelId(t,e,a){for(var s="<tr"+(0===a?"":' style="display: none; "')+'><td colspan="2" style="padding-left: '+(15*a+15+(0===a?0:16))+'px; text-align: left; "><form class="label-add-form inline"><input type="hidden" class="label-add-parent" value="'+e+'"/><input class="label-add-name inline" style="margin-left: -8px; " type="text" placeholder="Label name" required="true"/>&nbsp;<input class="label-add-button inline" type="submit" value="Add label"/></form></td>',i=getLabelIdsWithIndenting(t,a),l=0;l<i.length;l++){var n=t[getLabelIndexByLabelId(t,i[l])];n.parent_label==e&&(s+=getSingleListElementOfLabelList(n,a),s+=getHtmlListOfLabelId(t,i[l],a+1))}return s}function getSingleListElementOfLabelList(t,e){var a=numberOfSubLabels(labels,t.id),s=expandedLabelsIds.contains(t.id),i=expandedLabelsIds.contains(t.parent_label),l='<tr data-label-id="'+t.id+'" data-indenting="'+e+'"'+(0===e||i?"":' style="display: none; "')+' id="label-list-row-id-'+t.id+'">';return l+='<form class="label-rename-form" id="label-rename-form-'+t.id+'" data-label-id="'+t.id+'"></form>',l+='<td class="label-list-first-cell" style="padding-left: '+(15*e+15+(0===a?16:0))+'px; " id="label-rename-table-cell-'+t.id+'">'+(a>0?'<img src="img/'+(s?"collapse":"expand")+'.svg" data-state="'+(s?"expanded":"collapsed")+'" class="small-exp-col-icon" />':"")+'&nbsp;<label class="checkbox-wrapper"><input type="checkbox" data-label-id="'+t.id+'" '+(labelAttachedToList(shownListData,t.id)?'checked="true"':"")+"/><span>&nbsp;"+t.name+"</span></label></td>",l+='<td><img class="small-menu-open-image" src="img/menu-small.svg" /><div class="small-menu display-none"><input type="submit" class="width-100" form="label-rename-form-'+t.id+'" id="label-rename-button-'+t.id+'" data-action="rename-edit" value="Rename" /><br><input type="button" class="label-add-sub-label width-100" value="Add sub-label"/><br><form class="label-remove-form inline"><input type="hidden" class="label-remove-select" value="'+t.id+'"/><input class="label-remove-button width-100" type="submit" value="Remove" /></form></td></div></tr>'}function getLabelIndexByLabelId(t,e){for(var a=0;a<t.length;a++)if(e==t[a].id)return a;return-1}function numberOfSubLabels(t,e){for(var a=0,s=getLabelIndenting(t,getLabelIndexByLabelId(t,e)),i=getLabelIdsWithIndenting(t,s+1),l=0;l<i.length;l++)t[getLabelIndexByLabelId(t,i[l])].parent_label==e&&a++;return a}function labelAttachedToList(t,e){for(var a=0;a<t.labels.length;a++)if(e==t.labels[a].id)return!0;return!1}function getLabelIdsWithIndenting(t,e){for(var a=[],s=0;s<t.length;s++)getLabelIndenting(t,s)===e&&a.push(t[s].id);return a}function getLabelIndenting(t,e){return void 0===t[e]?void 0:0===t[e].parent_label?0:getLabelIndenting(t,getLabelIndexByLabelId(t,t[e].parent_label))+1}function addLabel(t,e,a,s){jQuery.ajax("server.php",{data:{action:"add-label",label_name:e,parent_label_id:a},type:"GET",error:function(){}}).done(function(t){t=handleAjaxResponse(t),s()})}function attachListToLabel(t,e,a){setLabelListAttachment(t,e,1,a)}function detachListFromLabel(t,e,a){setLabelListAttachment(t,e,0,a)}function setLabelListAttachment(t,e,a,s){void 0===e&&(e=shownListId),jQuery.ajax("server.php",{data:{action:"set-label-list-attachment",label_id:t,list_id:e,attachment:a},type:"GET",error:function(){}}).done(function(t){t=handleAjaxResponse(t),s(t)})}function removeLabel(t,e){jQuery.ajax("server.php",{data:{action:"remove-label",label_id:t},type:"GET",error:function(){}}).done(function(t){t=handleAjaxResponse(t),e(t)})}function renameLabel(t,e,a){jQuery.ajax("server.php",{data:{action:"rename-label",label_id:t,label_name:e},type:"GET",error:function(){}}).done(function(t){t=handleAjaxResponse(t),a(t)})}function renameList(t,e,a){jQuery.ajax("server.php",{data:{action:"rename-word-list",word_list_id:t,word_list_name:e},type:"GET",error:function(){}}).done(function(t){t=handleAjaxResponse(t),a(t)})}var noWordListOutput='<p class="spacer-top-15">You haven\'t created any wordlists yet.</p>',noSharedWordListOutput="<p>There are no shared lists to show.</p>",listNotShared='<p class="spacer-top-15">The selected list isn\'t shared with anyone. Only you can see it.</p>',noWordsInList='<p class="spacer-top-15">The selected list doesn\'t contain any words yet.</p>',noWordsInListDisallowEdit='<p class="spacer-top-15">The selected list doesn\'t contain any words yet.</p>',noLabels="<p>You don't have any labels.</p>",shownListId=-1,shownListData=null,labels=null,expandedLabelsIds=[];$(window).on("page-word-lists",function(t,e,a){var s=parseInt(a);if(s!==shownListId)if(isNaN(s)){if(-1!==shownListId)return void(window.location.hash="#/word-lists/"+shownListId);showNoListSelectedInfo(!0)}else loadWordList(parseInt(a),!0,!1)}),$("#word-list-add-form").on("submit",function(t){t.preventDefault(),$("#word-list-add-name").prop("disabled",!0),$("#word-list-add-button").prop("disabled",!0).attr("value","Creating list..."),addWordList($("#word-list-add-name").val(),function(t){$("#word-list-add-name").prop("disabled",!1).val(""),$("#word-list-add-button").prop("disabled",!1).attr("value","Create list"),refreshListOfWordLists(!1,function(){setAllListRowsAsNotActive(),$("#list-of-word-lists tr[data-list-id="+t.id+"]").addClass("active").find("input[type=button]").first().hide()}),loadWordList(t.id,!0)})}),$("#words-add-form").on("submit",function(t){t.preventDefault();var e=$("#words-add-language1").val(),a=$("#words-add-language2").val();$("#words-add-language1").val("").focus(),$("#words-add-language2").val(""),addWord(e,a,!0)}),$("#share-list-form").on("submit",function(t){t.preventDefault(),$("#share-list-other-user-email").prop("disabled",!0),$("#share-list-permissions").prop("disabled",!0),$("#share-list-submit").prop("disabled",!0).attr("value","Sharing...");var e=$("#share-list-other-user-email").val();setSharingPermissions(shownListId,e,$("#share-list-permissions").val(),function(t){if($("#share-list-other-user-email").prop("disabled",!1).val(""),$("#share-list-permissions").prop("disabled",!1),$("#share-list-submit").prop("disabled",!1).attr("value","Share"),refreshListSharings(!1,shownListId),-1===t.set_permissions){var a=new MessageBox;a.setTitle("Not shared"),a.setContent('Found no user with the given email-address (<span class="italic">'+e+"</span>)."),a.show()}})}),$("body").on("click",function(){$(".small-menu").addClass("display-none")}),refreshListOfWordLists(!0,void 0,!0),refreshListOfSharedWordLists(!0,!0);
function List(e,t,r,n,s,a,o,u){this.id=e,this.name=t,this.creator=r,this.language1=s,this.language2=a,this.comment=n,this.creation_time=o,this.words=[];for(var i=0;i<u.length;i++)this.words.push(new Word(u[i].id,u[i].list,u[i].language1,u[i].language2,u[i].answers));this.getName=function(){return this.name},this.getKnownAverage=function(){if(0===this.words.length)return 0;for(var e=0,t=0;t<this.words.length;t++)e+=this.words[t].getKnownAverage();return e/this.words.length}}function Word(e,t,r,n,s){this.id=e,this.language1=r,this.language2=n,this.list=t,this.answers=[];for(var a=0;a<s.length;a++)this.answers.push(new QueryAnswer(s[a].word,s[a].correct,s[a].id,s[a].time));this.getKnownAverage=function(){return this.getKnownAverageOverLastNAnswers(this.answers.length)},this.getKnownAverageOverLastNAnswers=function(e){if(0===this.answers.length)return 0;if(e>this.answers.length)return Math.map(this.getKnownAverage(),0,1,0,this.answers.length/e);for(var t=0,r=this.answers.length-e;r<this.answers.length;r++)1===this.answers[r].correct&&t++;return t/e}}function QueryAlgorithm(){}function QueryAnswer(e,t,r,n){this.word=e,this.correct=t,this.time=void 0===n?Date.seconds():n,this.id=void 0===r?void 0:r}function refreshQueryLabelList(e){e&&$("#query-selection").html(loading),jQuery.ajax("server.php",{data:{action:"get-query-data"},type:"GET",error:function(){}}).done(function(e){var t=handleAjaxResponse(e);queryLabels=t.labels,queryAttachments=t.label_list_attachments,queryLists=[];for(var r=0;r<t.lists.length;r++)queryLists.push(new List(t.lists[r].id,t.lists[r].name,t.lists[r].creator,t.lists[r].comment,t.lists[r].language1,t.lists[r].language2,t.lists[r].creation_time,t.lists[r].words));$("#query-selection").html('<p><input id="query-start-button" type="button" value="Start test" class="width-100 height-50px font-size-20px" disabled="true"/></p><div id="query-label-selection"></div><div id="query-list-selection"></div><br class="clear-both">'),$("#query-label-selection").html(getHtmlTableOfLabelsQuery(queryLabels)),refreshQueryListSelection(),$("#query-start-button").on("click",startQuery),$("#query-label-selection tr").on("click",function(){var e=$(this).data("query-label-id");$(this).data("checked")===!0?removeLabelFromQuery(e):$(this).data("checked")===!1&&addLabelToQuery(e)}),$("#query-label-selection .small-exp-col-icon").on("click",function(e){e.stopPropagation();for(var t=$(this),r="collapsed"==t.data("state"),n=0,s=t.parent().parent(),a=s.nextAll(),o=s.data("indenting");a.eq(n).length>0&&(a.eq(n).data("indenting")>o||void 0===a.eq(n).data("indenting"));)a.eq(n).data("indenting")!=o+1&&r||(r?a.eq(n).show():(a.eq(n).hide(),a.eq(n).find(".small-exp-col-icon").attr("src","img/expand.svg").data("state","collapsed"))),n++;r?t.data("state","expanded").attr("src","img/collapse.svg"):t.data("state","collapsed").attr("src","img/expand.svg")})})}function refreshQueryListSelection(){var e="";queryLists.sort(compareListsByName);for(var t=0;t<queryLists.length;t++){var r=!1;querySelectedLists.contains(queryLists[t].id)&&(r=!0),e+=getListRow(queryLists[t],r)}$("#query-list-selection").html('<table class="box-table cursor-pointer"><tr class="cursor-default"><th colspan="2">Lists</th></tr>'+e+"</table"),$("#query-list-selection tr").on("click",function(){var e=$(this).data("query-list-id");$(this).data("checked")===!0?removeListFromQuery(e):$(this).data("checked")===!1&&addListToQuery(e)})}function addLabelToQuery(e){for(var t=0;t<queryAttachments.length;t++)queryAttachments[t].label==e&&addListToQuery(queryAttachments[t].list);$("#query-label-selection tr[data-query-label-id="+e+"]").addClass("active").data("checked",!0),querySelectedLabel.push(e)}function removeLabelFromQuery(e){for(var t=0;t<queryAttachments.length;t++)queryAttachments[t].label==e&&removeListFromQuery(queryAttachments[t].list);$("#query-label-selection tr[data-query-label-id="+e+"]").removeClass("active").data("checked",!1),querySelectedLabel.removeAll(e)}function addListToQuery(e){querySelectedLists.push(e),$("#query-list-selection tr[data-query-list-id="+e+"]").data("checked",!0).addClass("active"),checkStartQueryButtonEnable()}function removeListFromQuery(e){querySelectedLists.removeAll(e),$("#query-list-selection tr[data-query-list-id="+e+"]").data("checked",!1).removeClass("active"),checkStartQueryButtonEnable()}function getListRow(e,t){return"<tr"+(t?'class="active"':"")+' data-query-list-id="'+e.id+'" data-checked="false"><td>'+e.name+"</td><td>"+e.words.length+" word"+(1==e.words.length?"":"s")+"</td></tr>"}function checkStartQueryButtonEnable(){$("#query-start-button").prop("disabled",0===querySelectedLists.length)}function compareListsByName(e,t){return e.name<t.name?-1:e.name>t.name?1:0}function getHtmlTableOfLabelsQuery(e){var t=getHtmlListOfLabelIdQuery(e,0,0);return t=t.length>0?'<table class="box-table cursor-pointer"><tr class="cursor-default"><th>Labels</th></tr>'+t+"</table>":noLabels}function getHtmlListOfLabelIdQuery(e,t,r){for(var n="",s=getLabelIdsWithIndenting(e,r),a=0;a<s.length;a++){var o=e[getLabelIndexByLabelId(e,s[a])];o.parent_label==t&&(n+=getSingleListElementOfLabelListQuery(o,r),n+=getHtmlListOfLabelIdQuery(e,s[a],r+1))}return n}function getSingleListElementOfLabelListQuery(e,t){var r=numberOfSubLabels(queryLabels,e.id),n=!1;return'<tr data-checked="false" data-query-label-id="'+e.id+'" data-indenting="'+t+'"'+(0===t?"":' style="display: none; "')+'><td class="label-list-first-cell" style="padding-left: '+(15*t+15+(0===r?16:0))+'px; ">'+(r>0?'<img src="img/'+(n?"collapse":"expand")+'.svg" data-state="'+(n?"expanded":"collapsed")+'" class="small-exp-col-icon" />':"")+"&nbsp;"+e.name+"</td></tr>"}function getListById(e){for(var t=0;t<queryLists.length;t++)if(queryLists[t].id===e)return queryLists[t];return void 0}function startQuery(){$("#query-not-started-info").addClass("display-none"),$("#query-content-table").removeClass("display-none"),queryRunning=!0,queryWords=[];for(var e=0;e<querySelectedLists.length;e++)queryWords=queryWords.concat(getListById(querySelectedLists[e]).words);for(var t=[],r=0;r<queryWords.length;r++)t.push(queryWords[r].id);queryInOrderAlgorithm=new QueryAlgorithm.InOrder(queryWords),queryGroupWordsAlgorithm=new QueryAlgorithm.GroupWords(queryWords),nextWord(),$('#query-box img[data-action="expand"]').trigger("expand")}function nextWord(){queryCurrentAnswerState=QueryAnswerState.Start,queryWrongAnswerGiven=!1,$("#query-answer-not-known").prop("disabled",!1),$("#query-answer-known").attr("value","I know!"),$("#query-answer-not-known").attr("value","No idea."),$("#query-answer-buttons").hide(),$("#correct-answer").hide(),$("#query-answer-not-sure").prop("disabled",!1),currentWord=getNextWord();var e=getListById(currentWord.list);currentDirection=queryChosenDirection==QueryDirection.Both?Math.round(Math.random()):queryChosenDirection,currentDirection==QueryDirection.Ltr?($("#query-lang1").html(e.language1),$("#query-lang2").html(e.language2),$("#query-question").html(currentWord.language1),currentWordCorrectAnswer=currentWord.language2):currentDirection==QueryDirection.Rtl&&($("#query-lang1").html(e.language2),$("#query-lang2").html(e.language1),$("#query-question").html(currentWord.language2),currentWordCorrectAnswer=currentWord.language1),setTimeout(function(){$("#query-answer").val("").focus()},10),$("#query-word-mark").html(Math.round(100*currentWord.getKnownAverage())+"%")}function getNextWord(){switch(queryChosenAlgorithm){case QueryAlgorithmEnum.Random:return queryWords.getRandomElement();case QueryAlgorithmEnum.UnderAverage:var e=Word.getKnownAverageOfArray(queryWords);return Word.getWordKnownBelow(queryWords,e);case QueryAlgorithmEnum.InOrder:return queryInOrderAlgorithm.getNextWord();case QueryAlgorithmEnum.GroupWords:return queryGroupWordsAlgorithm.getNextWord()}}function addQueryAnswer(e,t){var r=new QueryAnswer(e.id,t);queryAnswers.push(r),e.answers.push(r)}function checkAnswer(e,t){return e.trim()==t.trim()}function refreshQueryResultsUploadButton(){var e=queryAnswers.length-nextIndexToUpload;$("#query-results-upload-button").prop("disabled",!(e>0)).attr("value","Upload "+(e>0?e+" ":"")+"answer"+(1==e?"":"s"))}function uploadQueryResults(){var e=queryAnswers.slice(nextIndexToUpload);nextIndexToUpload=queryAnswers.length,refreshQueryResultsUploadButton(),$.ajax({type:"POST",url:"server.php?action=upload-query-results",data:{answers:JSON.stringify(e)},error:function(){queryAnswers.pushElements(e),refreshQueryResultsUploadButton()}}).done(function(e){e=handleAjaxResponse(e)})}function processQueryCurrentAnswerState(){switch(queryCurrentAnswerState){case queryCurrentAnswerState.Start:return;case QueryAnswerState.Known:return $("#query-box").trigger("shadow-blink-green"),addQueryAnswer(currentWord,1),tryAutoUpload(),void nextWord();case QueryAnswerState.NotSureClicked:return $("#query-answer-not-sure").prop("disabled",!0),$("#query-answer-known").attr("value","I knew that!"),$("#query-answer-not-known").attr("value","I didn't know that."),void showQuerySolution();case QueryAnswerState.NotKnownClicked:queryCurrentAnswerState=QueryAnswerState.WaitToContinue;case QueryAnswerState.NotKnown:return $("#query-answer-not-known").prop("disabled",!0),$("#query-answer-not-sure").prop("disabled",!0),$("#query-answer-known").attr("value","Continue."),$("#query-word-mark").html(Math.round(100*currentWord.getKnownAverage())+"%"),showQuerySolution(),addQueryAnswer(currentWord,0),void tryAutoUpload()}}function showQuerySolution(){$("#query-answer-buttons").show().html(currentWordCorrectAnswer),$("#correct-answer").show().html(currentWordCorrectAnswer),$("#query-answer").select()}function setQueryType(e){queryChosenType!=e&&(queryChosenType=e,e==QueryType.Buttons?($("#query-answer-table-cell-text-box").hide(),$("#query-answer-table-cell-buttons").show()):e==QueryType.TextBox&&($("#query-answer-table-cell-buttons").hide(),$("#query-answer-table-cell-text-box").show(),$("#query-answer").focus()))}function tryAutoUpload(){autoUploadEnabled()?uploadQueryResults():refreshQueryResultsUploadButton()}function autoUploadEnabled(){return $("#query-results-auto-upload").is(":checked")}Word.getWordKnownBelow=function(e,t){for(var r=[],n=0;n<e.length;n++)e[n].getKnownAverage()<t&&r.push(e[n]);return r.getRandomElement()},Word.getKnownAverageOfArray=function(e){if(0===e.length)return 0;for(var t=0,r=0;r<e.length;r++)t+=e[r].getKnownAverage();return t/e.length},QueryAlgorithm.InOrder=function(e){this.index=-1,this.words=e,this.iterations=0,this.getNextWord=function(){return 0===this.words.length?void 0:(this.words.length===this.index+1&&(this.index=-1,this.iterations++),this.index++,this.words[this.index])}},QueryAlgorithm.GroupWords=function(e,t,r){void 0===t&&(t=6),void 0===r&&(r=4),this.groupSize=t,this.careAboutLastNAnswers=r,this.words=e.slice().shuffle(),this.index=t<this.words.length?t:0,this.lastReturnedWord=null,this.currentGroup=[],this.currentGroup=this.words.length>t?this.words.slice(0,t):e,this.getNextWord=function(){for(var e=0;e<this.currentGroup.length;e++)1===this.currentGroup[e].getKnownAverageOverLastNAnswers(this.careAboutLastNAnswers)&&(this.index++,this.index>=this.words.length&&(this.index=0),this.currentGroup[e]=this.words[this.index]);return this.currentGroup.getRandomElement()}};var QueryAlgorithmEnum=Object.freeze({Random:0,UnderAverage:1,GroupWords:2,InOrder:3}),QueryDirection=Object.freeze({Both:-1,Ltr:0,Rtl:1}),QueryType=Object.freeze({TextBox:0,Buttons:1}),QueryAnswerState=Object.freeze({Start:0,NotSureClicked:1,Known:2,NotKnown:3,WaitToContinue:4,NotKnownClicked:5}),queryLabels=null,queryAttachments=null,queryLists=null,querySelectedLabel=[],querySelectedLists=[],queryWords=[],queryChosenAlgorithm=QueryAlgorithmEnum.Random,queryChosenDirection=QueryDirection.Both,queryChosenType=QueryType.TextBox,queryRunning=!1,currentWord=null,currentDirection=null,currentWordCorrectAnswer=null,queryWrongAnswerGiven=!1,queryAnswers=[],nextIndexToUpload=0,queryCurrentAnswerState=QueryAnswerState.Start,queryInOrderAlgorithm,queryGroupWordsAlgorithm;$("#query-answer").on("keypress",function(e){if(13==e.which)if(checkAnswer($(this).val(),currentWordCorrectAnswer))queryCurrentAnswerState==QueryAnswerState.NotKnown||queryCurrentAnswerState==QueryAnswerState.NotSureClicked||queryCurrentAnswerState==QueryAnswerState.WaitToContinue?nextWord():(queryCurrentAnswerState=QueryAnswerState.Known,processQueryCurrentAnswerState());else{if(queryCurrentAnswerState==QueryAnswerState.NotKnown)return;queryCurrentAnswerState=QueryAnswerState.NotKnown,processQueryCurrentAnswerState()}}),$("#query-results-upload-button").on("click",uploadQueryResults),$("#query-answer-known").on("click",function(){queryCurrentAnswerState==QueryAnswerState.WaitToContinue||queryCurrentAnswerState==QueryAnswerState.NotKnown?nextWord():(queryCurrentAnswerState=QueryAnswerState.Known,processQueryCurrentAnswerState())}),$("#query-answer-not-sure").on("click",function(){queryCurrentAnswerState=QueryAnswerState.NotSureClicked,processQueryCurrentAnswerState()}),$("#query-answer-not-known").on("click",function(){queryCurrentAnswerState=QueryAnswerState.NotKnownClicked,processQueryCurrentAnswerState()}),$("#query-algorithm tr").on("click",function(){$("#query-algorithm tr").removeClass("active"),$(this).addClass("active"),queryChosenAlgorithm=parseInt($(this).data("algorithm"))}),$("#query-direction tr").on("click",function(){$("#query-direction tr").removeClass("active"),$(this).addClass("active"),queryChosenDirection=parseInt($(this).data("direction"))}),$("#query-type tr").on("click",function(){$("#query-type tr").removeClass("active"),$(this).addClass("active"),setQueryType(parseInt($(this).data("type")))}),$("#query-results-auto-upload").on("click",function(){autoUploadEnabled()&&uploadQueryResults()}),refreshQueryLabelList(!0);
function addUser(e,d){jQuery.ajax("server.php",{data:{action:"add-user",email:e},type:"GET",error:function(){}}).done(function(e){e=handleAjaxResponse(e),refreshListOfAddedUsers(!1),refreshListOfSharedWordLists(!0),d(e)})}function removeUser(e){$("#added-users-remove-"+e).prop("disabled",!0).attr("value","Removing..."),jQuery.ajax("server.php",{data:{action:"remove-user",id:e},type:"GET",error:function(){}}).done(function(d){d=handleAjaxResponse(d),$("#added-users-row-"+e).remove(),1==$("#people-you-have-added tr").length&&$("#people-you-have-added").html(noUsersAddedOutput),refreshListOfUsersWhoHaveAddedYou(!1),refreshListOfSharedWordLists(!0)})}function refreshListOfAddedUsers(e){e&&$("#people-you-have-added").html(loading),jQuery.ajax("server.php",{data:{action:"list-of-added-users"},type:"GET",error:function(){}}).done(function(e){e=handleAjaxResponse(e);for(var d="",t=0;t<e.length;t++)d+='<tr id="added-users-row-'+e[t].id+'"><td>'+e[t].firstname+" "+e[t].lastname+"</td><td>"+e[t].email+'</td><td><input id="added-users-remove-'+e[t].id+'" type="button" class="inline" value="Remove" onclick="removeUser('+e[t].id+')"/></td></tr>';d=0===d.length?noUsersAddedOutput:'<table class="box-table button-right-column"><tr class="bold cursor-default"><td>Name</td><td>Email-Address</td><td></td></tr>'+d+"</table>",$("#people-you-have-added").html(d)})}function refreshListOfUsersWhoHaveAddedYou(e){e&&$("#people-who-have-added-you").html(loading),jQuery.ajax("server.php",{data:{action:"list-of-users-who-have-added-you"},type:"GET",error:function(){}}).done(function(e){e=handleAjaxResponse(e);for(var d="",t=0;t<e.length;t++)d+="<tr><td>"+e[t].firstname+" "+e[t].lastname+"</td><td>"+e[t].email+"</td><td>"+(e[t].bidirectional?"":'<input type="button" class="inline" value="Add user" data-email="'+e[t].email+'"/>')+"</td></tr>";d=0===d.length?noUsersHaveAddedYouOutput:'<table class="box-table button-right-column"><tr class="bold cursor-default"><td>Name</td><td>Email-Address</td><td></td></tr>'+d+"</table>",$("#people-who-have-added-you").html(d),$("#people-who-have-added-you input[type=button]").on("click",function(){var e=$(this);e.prop("disabled",!0).val("Adding..."),addUser(e.data("email"),function(){e.fadeOut()})})})}var noUsersAddedOutput='<p class="spacer-top-15">You haven\'t added other users yet.</p>',noUsersHaveAddedYouOutput='<p class="spacer-top-15">No users have added you yet.</p>';$("#user-add-form").on("submit",function(e){e.preventDefault(),$("#user-add-email").prop("disabled",!0),$("#user-add-button").prop("disabled",!0).attr("value","Adding..."),addUser($("#user-add-email").val(),function(e){$("#user-add-email").prop("disabled",!1).val(""),$("#user-add-button").prop("disabled",!1).attr("value","Add user");var d;d=-1===e?"Email-address does not exist.":0===e?"You have already added this user.":1===e?"User has been added.":2===e?"You can not add yourself.":"An unknown error occured.",$("#user-add-message").html(d)})}),refreshListOfAddedUsers(!0),refreshListOfUsersWhoHaveAddedYou(!0);
function showSettingsPage(e){shownSettingsSubPageName=e,$("#settings-menu tr").removeClass("active"),$("#settings-menu tr[data-page="+e+"]").addClass("active"),$("#settings-content > div").addClass("display-none"),$("#settings-content > div[data-page="+e+"]").removeClass("display-none")}var shownSettingsSubPageName;$(window).on("page-settings",function(e,s,t){t!==shownSettingsSubPageName&&(t||(t=shownSettingsSubPageName?shownSettingsSubPageName:"profile"),showSettingsPage(t),location.hash="#/settings/"+t,t&&showSettingsPage(t))}),$("#settings-menu tr").on("click",function(){location.hash="#/settings/"+$(this).data("page")}),$("#settings-name").on("submit",function(e){e.preventDefault(),$("#settings-firstname, #settings-lastname").prop("disabled",!0),$("#settings-submit-button").prop("disabled",!0).attr("value","Changing name..."),$("#settings-name-response").html("").addClass("display-none"),jQuery.ajax("server.php",{data:{action:"set-name",firstname:$("#settings-firstname").val(),lastname:$("#settings-lastname").val()},type:"GET",error:function(){}}).done(function(e){e=handleAjaxResponse(e),$("#settings-firstname, #settings-lastname").prop("disabled",!1),$("#settings-submit-button").prop("disabled",!1).attr("value","Change name");var s="";switch(e){case"0":s="The given name is not valid.";break;case"1":s="Your name has been update successfully.";break;default:s="An unknown error occured."}$("#settings-name-response").html(s).removeClass("display-none")})}),$("#settings-password").on("submit",function(e){e.preventDefault(),$("#settings-password-old, #settings-password-new, #settings-password-new-confirm").prop("disabled",!0),$("#settings-password-button").prop("disabled",!0).attr("value","Changing password..."),$("#settings-password-response").html("").addClass("display-none"),jQuery.ajax("server.php?action=set-password",{data:{password_old:$("#settings-password-old").val(),password_new:$("#settings-password-new").val(),password_new_confirm:$("#settings-password-new-confirm").val()},type:"POST",error:function(){}}).done(function(e){e=handleAjaxResponse(e),$("#settings-password-old, #settings-password-new, #settings-password-new-confirm").prop("disabled",!1).attr("value",""),$("#settings-password-button").prop("disabled",!1).attr("value","Change password");var s="";switch(e){case"1":s="Your password has been updated successfully.";break;case"2":s="The two new passwords are not equal.";break;case"3":s="Your old password is not correct.";break;case"5":s="The new password is not valid.";break;default:s="An unknown error occured."}$("#settings-password-response").html(s).removeClass("display-none")})}),$("#settings-delete-account-form").on("submit",function(e){e.preventDefault();var s=new MessageBox;s.setTitle("Delete account"),s.setContent("Are you sure you want to delete your account?"),s.setButtons(MessageBox.ButtonType.YesNoCancel),s.setCallback(function(e){"Yes"===e&&($("#settings-delete-account-password").prop("disabled",!0),$("#settings-delete-account-button").prop("disabled",!0).attr("value","Deleting account..."),$("#settings-delete-account-response").html("").addClass("display-none"),jQuery.ajax("server.php?action=delete-account",{data:{password:$("#settings-delete-account-password").val()},type:"POST",error:function(){}}).done(function(e){e=handleAjaxResponse(e),1===e?window.location.replace("server.php?action=logout"):($("#settings-delete-account-password").prop("disabled",!1).val(""),$("#settings-delete-account-button").prop("disabled",!1).attr("value","Delete account"),$("#settings-delete-account-response").html(0===e?"The password is not correct.":"An unknown error occured.").removeClass("display-none"))}))}),s.show()});